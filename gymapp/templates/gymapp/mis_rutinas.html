{% extends "gymapp/base.html" %}

{% block extra_head %}
<link href="https://unpkg.com/tabulator-tables@5.6.2/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://unpkg.com/tabulator-tables@5.6.2/dist/js/tabulator.min.js"></script>
{% endblock %}

{% block content %}
<div class="container mt-4 rutina-form">
    <h3 class="text-center">Rutinas de {{ member.nombre_apellido }}</h3>
    <hr>

    {% for rutina in rutinas %}
        <div class="card mb-4 shadow-sm">
            <div class="card-header rutinas-card-header">
                {{ rutina.get_estructura_display }} - {{ rutina.fecha_creacion|date:"d/m/Y H:i" }}
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <div id="rutinasTable-{{ rutina.id }}" class="tabulator--bootstrap5 rutinasTable"></div>
                </div>

                {% if rutina.comentario %}
                <div class="mt-2">
                    <strong>Comentario:</strong> {{ rutina.comentario.texto }}
                </div>
                {% endif %}
            </div>
        </div>
    {% empty %}
        <p class="text-muted">Todavía no tenés rutinas cargadas.</p>
    {% endfor %}
</div>

<script>
  const rutinasData = {{ rutinas_data|safe }};
  {% for rutina in rutinas %}
  new Tabulator("#rutinasTable-{{ rutina.id }}", {
    data: rutinasData["{{ rutina.id }}"],
    layout: "fitDataFill",
    columns: [
      {title: "Categoría", field: "categoria"},
      {title: "Ejercicio", field: "ejercicio"},
      {title: "Series", field: "series", hozAlign: "center"},
      {title: "Reps", field: "repeticiones", hozAlign: "center"},
      {title: "Peso", field: "peso", hozAlign: "center"},
      {title: "Descanso", field: "descanso"},
      {title: "RIR", field: "rir", hozAlign: "center"},
      {title: "Sensaciones", field: "sensaciones"},
      {title: "Notas", field: "notas"}
    ]
  });
  {% endfor %}
</script>
{% endblock %}
