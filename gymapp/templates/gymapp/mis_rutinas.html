{% extends "gymapp/base.html" %}

{% block extra_head %}
<link href="https://unpkg.com/tabulator-tables@5.6.2/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://unpkg.com/tabulator-tables@5.6.2/dist/js/tabulator.min.js"></script>
{% endblock %}

{% block content %}
<div class="container mt-4 rutina-form">
    <h3 class="text-center">Rutinas de {{ member.nombre_apellido }}</h3>
    <hr>

    {% for rutina in rutinas %}
        <div class="card mb-4 shadow-sm">
            <div class="card-header rutinas-card-header">
                {{ rutina.get_estructura_display }} - {{ rutina.fecha_creacion|date:"d/m/Y H:i" }}
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <div id="rutinasTable{{ rutina.id }}" class="tabulator--bootstrap5"></div>
                </div>

                {% if rutina.comentario %}
                <div class="mt-2">
                    <strong>Comentario:</strong> {{ rutina.comentario.texto }}
                </div>
                {% endif %}
            </div>
        </div>
    {% empty %}
        <p class="text-muted">Todavía no tenés rutinas cargadas.</p>
    {% endfor %}
</div>

<script>
  const routinesData = {{ rutina_data|safe }};
  Object.entries(routinesData).forEach(([id, data]) => {
    new Tabulator(`#rutinasTable${id}`, {
      data: data,
      layout: "fitColumns",
      responsiveLayout: "collapse",
      groupBy: "categoria",
      pagination: "local",
      paginationSize: 10,
      columns: [
        {title: "Categoría", field: "categoria", headerSort: true, headerFilter: "input"},
        {title: "Ejercicio", field: "ejercicio", headerSort: true, headerFilter: "input"},
        {title: "Series", field: "series", hozAlign: "center", headerSort: true, headerFilter: "number"},
        {title: "Reps", field: "repeticiones", hozAlign: "center", headerSort: true, headerFilter: "number"},
        {title: "Peso", field: "peso", hozAlign: "center", headerSort: true, headerFilter: "number"},
        {title: "Descanso", field: "descanso", headerSort: true, headerFilter: "input"},
        {title: "RIR", field: "rir", hozAlign: "center", headerSort: true, headerFilter: "number"},
        {title: "Sensaciones", field: "sensaciones", headerSort: true, headerFilter: "input"},
        {title: "Notas", field: "notas", headerSort: true, headerFilter: "input"}
      ]
    });
  });
</script>
{% endblock %}
