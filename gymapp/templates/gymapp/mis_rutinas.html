{% extends "gymapp/base.html" %}

{% block extra_head %}
{% if USE_CDN %}
<link href="https://unpkg.com/tabulator-tables@5.6.2/dist/css/tabulator.min.css" rel="stylesheet"{% if CDN_INTEGRITY.tabulator_css %} integrity="{{ CDN_INTEGRITY.tabulator_css }}" crossorigin="anonymous"{% endif %}>
<script src="https://unpkg.com/tabulator-tables@5.6.2/dist/js/tabulator.min.js"{% if CDN_INTEGRITY.tabulator_js %} integrity="{{ CDN_INTEGRITY.tabulator_js }}" crossorigin="anonymous"{% endif %}></script>
{% else %}
<link href="{% static 'vendor/tabulator/tabulator.min.css' %}" rel="stylesheet">
<script src="{% static 'vendor/tabulator/tabulator.min.js' %}"></script>
{% endif %}
{% endblock %}

{% block content %}
<div class="container mt-4 rutina-form">
    <h3 class="text-center">Rutinas de {{ member.nombre_apellido }}</h3>
    <hr>

    {% for rutina in rutinas %}
        <div class="card mb-4 shadow-sm">
            <div class="card-header rutinas-card-header">
                {{ rutina.get_estructura_display }} - {{ rutina.fecha_creacion|date:"d/m/Y H:i" }}
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <div id="rutinasTable{{ forloop.counter }}" class="tabulator--bootstrap5"></div>
                </div>

                {% if rutina.comentario %}
                <div class="mt-2">
                    <strong>Comentario:</strong> {{ rutina.comentario.texto }}
                </div>
                {% endif %}
            </div>
        </div>
    {% empty %}
        <p class="text-muted">Todavía no tenés rutinas cargadas.</p>
    {% endfor %}
</div>

<script>
  const rutinasData = {{ rutina_data|safe }};
  Object.keys(rutinasData).forEach((id, index) => {
    new Tabulator(`#rutinasTable${index + 1}`, {
      data: rutinasData[id],
      layout: "fitDataFill",
      columns: [
        {title: "Categoría", field: "categoria"},
        {title: "Ejercicio", field: "ejercicio"},
        {title: "Series", field: "series", hozAlign: "center"},
        {title: "Reps", field: "repeticiones", hozAlign: "center"},
        {title: "Peso", field: "peso", hozAlign: "center"},
        {title: "Descanso", field: "descanso"},
        {title: "RIR", field: "rir", hozAlign: "center"},
        {title: "Sensaciones", field: "sensaciones"},
        {title: "Notas", field: "notas"}
      ]
    });
  });
</script>
{% endblock %}
